Perfetto! Ecco il **prompt dettagliato** da fornire a Replit Agent o al tuo developer:

---

## ðŸŽ¯ PROMPT PER IMPLEMENTAZIONE MODIFICHE SISTEMA GESTIONE COMMESSE

### OBIETTIVO
Aggiungere al sistema di gestione commesse la classificazione delle prestazioni professionali secondo gli standard degli studi di ingegneria italiani (DM 143/2013).

### MODIFICHE DATABASE

Aggiungi questi nuovi campi alla tabella `commesse`:

```sql
-- Nuovi campi per classificazione prestazione
prestazioni_json TEXT, -- Array JSON con tipologie: ["progettazione", "dl", "csp", "cse", "contabilita", "collaudo", "perizia", "pratiche"]
livello_progettazione_json TEXT, -- Array JSON: ["pfte", "definitivo", "esecutivo", "variante"]
classe_dm143 VARCHAR(10), -- Es: "E22", "IA03", "S05"
importo_opere DECIMAL(12,2), -- Importo lavori base calcolo parcella
importo_servizio DECIMAL(10,2), -- Importo servizio professionale al netto
percentuale_parcella DECIMAL(5,2) -- % parcella applicata
```

### MODIFICHE FRONTEND - TABELLA PRINCIPALE

**1. Aggiungi due nuove colonne dopo "Oggetto":**

**Colonna "Prestazioni":**
- Mostra badge colorati per ogni prestazione attiva
- Usa icone emoji: ðŸ“ Progettazione, ðŸ‘· DL, ðŸ›¡ï¸ CSP/CSE, âœ… Collaudo, âš–ï¸ Perizia, ðŸ“‹ Pratiche
- Colori badge:
  - Progettazione: `background: #e3f2fd; color: #1565c0`
  - DL: `background: #f3e5f5; color: #6a1b9a`
  - CSP/CSE: `background: #fff3e0; color: #e65100`
  - Collaudo: `background: #e8f5e9; color: #2e7d32`
  - Perizia: `background: #fce4ec; color: #c2185b`
  - Pratiche: `background: #fce4ec; color: #c2185b`

**Colonna "Classe DM 143/2013":**
- Badge scuro con codice classe: `background: #263238; color: white; font-family: monospace`
- Sotto: importo opere in grigio piccolo (â‚¬ formato)
- Se importo_opere Ã¨ NULL o 0, mostra "Forfait"

**2. Evidenzia le nuove colonne con:**
```css
.new-column {
    background: #f1f8e9 !important;
}
```

### MODIFICHE FRONTEND - MODAL DETTAGLI

**Crea un modal/dialog che si apre cliccando sul pulsante "Dettagli" con:**

**Sezione 1: Tipologia Prestazioni (checkbox multipli)**
- [ ] ðŸ“ Progettazione
- [ ] ðŸ‘· Direzione Lavori
- [ ] ðŸ›¡ï¸ CSP (Coordinamento Sicurezza Progettazione)
- [ ] ðŸ›¡ï¸ CSE (Coordinamento Sicurezza Esecuzione)
- [ ] ðŸ“Š ContabilitÃ  Lavori
- [ ] âœ… Collaudo
- [ ] âš–ï¸ Perizia/CTU/CTP
- [ ] ðŸ“‹ Pratiche Strutturali/Edilizie

**Sezione 2: Livello Progettazione (se "Progettazione" Ã¨ selezionato)**
- [ ] PFTE (Progetto FattibilitÃ  Tecnico-Economica)
- [ ] Progetto Definitivo
- [ ] Progetto Esecutivo
- [ ] Variante in corso d'opera

**Sezione 3: Classificazione DM 143/2013**
- Campo testo: "Classe e Categoria" (placeholder: "Es: E22, IA03, S05")
- Campo numerico: "Importo Opere (â‚¬)" (placeholder: "Importo base per calcolo parcella")
- Campo numerico: "Importo Servizio Professionale (â‚¬)" (placeholder: "Al netto di cassa e IVA")
- Campo numerico: "% Parcella Applicata" (step: 0.01)

**Pulsante salvataggio:** "ðŸ’¾ Salva Classificazione"

### LOGICA IMPLEMENTAZIONE

**1. Rendering prestazioni in tabella:**
```javascript
function renderPrestazioni(prestazioniJson) {
    const prestazioni = JSON.parse(prestazioniJson || '[]');
    const icone = {
        'progettazione': { icona: 'ðŸ“', label: 'Prog.', classe: 'badge-prog' },
        'dl': { icona: 'ðŸ‘·', label: 'DL', classe: 'badge-dl' },
        'csp': { icona: 'ðŸ›¡ï¸', label: 'CSP', classe: 'badge-csp' },
        'cse': { icona: 'ðŸ›¡ï¸', label: 'CSE', classe: 'badge-cse' },
        'collaudo': { icona: 'âœ…', label: 'Collaudo', classe: 'badge-collaudo' },
        'perizia': { icona: 'âš–ï¸', label: 'Perizia', classe: 'badge-perizia' },
        'pratiche': { icona: 'ðŸ“‹', label: 'Pratiche', classe: 'badge-pratica' }
    };
    
    return prestazioni.map(p => 
        `<span class="prestazione-badge ${icone[p].classe}">
            ${icone[p].icona} ${icone[p].label}
        </span>`
    ).join('');
}
```

**2. Rendering classe DM 143:**
```javascript
function renderClasseDM(classe, importoOpere) {
    if (!classe) return '<span class="classe-tag">-</span><div>Forfait</div>';
    
    const importoFormatted = new Intl.NumberFormat('it-IT', {
        style: 'currency',
        currency: 'EUR',
        maximumFractionDigits: 0
    }).format(importoOpere || 0);
    
    return `
        <span class="classe-tag">${classe}</span>
        <div style="font-size: 11px; color: #666; margin-top: 4px;">
            ${importoOpere ? importoFormatted : 'Forfait'}
        </div>
    `;
}
```

**3. Salvataggio dati dal modal:**
- Raccogli checkbox selezionati e salvali come JSON array
- Valida che almeno una prestazione sia selezionata
- Salva via API/POST al backend
- Aggiorna riga tabella senza ricaricare pagina (AJAX)

### VALIDAZIONI
- Almeno una prestazione deve essere selezionata
- Se "Progettazione" Ã¨ selezionata, richiedere il livello (PFTE/Def/Esec)
- Importo opere deve essere >= 0
- Classe DM Ã¨ opzionale (per forfait)

### ESPORTAZIONE DATI
Prepara la struttura dati per generare automaticamente:
- **Certificati di Regolare Esecuzione (CRE)**
- **Report per qualifiche SOA**
- **CV aziendale/portfolio**

### FILE DA MODIFICARE
1. **Database**: Schema commesse (migration SQL)
2. **Backend**: Controller/API per CRUD prestazioni
3. **Frontend**: 
   - Tabella principale (aggiunta colonne)
   - Modal dettagli (nuovo componente)
   - CSS per badge e styling
   - JavaScript per logica rendering

### NOTE TECNICHE
- Usa JSON per array prestazioni (flessibile per aggiunte future)
- Mantieni retrocompatibilitÃ : commesse esistenti con campi NULL
- Indicatore visivo "âœ¨ NUOVO" sulle colonne per i primi giorni
- Responsive: su mobile mostra badge piÃ¹ piccoli o stacked

---

**Questo prompt contiene tutto il necessario per implementare le modifiche. Copialo e incollalo su Replit Agent!** ðŸš€